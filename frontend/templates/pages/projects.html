{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/projects.css') }}">
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/pages/projects.js') }}"></script>
{% endblock %}

            <!-- Projects View -->
            <div class="view" id="projects-view">
                <div class="view-header">
                    <h1>Your Projects</h1>
                    <div class="project-selector">
                        <select id="existing-projects" class="select-modern">
                            <option value="">Select a project...</option>
                        </select>
                        <button class="btn-export" id="export-project-btn" style="display:none" title="Download as ZIP">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M8 2V10M8 10L5 7M8 10L11 7M3 14H13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Export ZIP
                        </button>
                        <button class="btn-export" id="download-report-btn" style="display:none" title="Download Executive Report">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                            Executive Report
                        </button>
                        <button class="btn-export" id="clone-project-btn" title="Clone a Git repository">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M6 3H3V13H13V10M9 3H13V7M13 3L7 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Clone from Git
                        </button>
                    </div>
                </div>

                <div class="project-workspace" id="project-workspace" style="display: none;">
                    <!-- Agent Pipeline Stepper -->
                    <div class="pipeline-container">
                        <div class="pipeline-header">
                            <h3><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg> Agent Pipeline</h3>
                            <div class="pipeline-status" id="pipeline-overall-status">Idle</div>
                        </div>
                        <div class="pipeline-stepper" id="pipeline-stepper">
                            <!-- Phases generated by JS -->
                            <div class="pipeline-step pending" data-phase="1">
                                <div class="step-icon">1</div>
                                <div class="step-label">Analysis</div>
                            </div>
                            <div class="pipeline-step pending" data-phase="2">
                                <div class="step-icon">2</div>
                                <div class="step-label">Planning</div>
                            </div>
                            <div class="pipeline-step pending" data-phase="3">
                                <div class="step-icon">3</div>
                                <div class="step-label">Scaffolding</div>
                            </div>
                            <div class="pipeline-step pending" data-phase="4">
                                <div class="step-icon">4</div>
                                <div class="step-label">Generation</div>
                            </div>
                            <div class="pipeline-step pending" data-phase="5">
                                <div class="step-icon">5</div>
                                <div class="step-label">Refinement</div>
                            </div>
                            <div class="pipeline-step pending" data-phase="6">
                                <div class="step-icon">6</div>
                                <div class="step-label">Testing</div>
                            </div>
                            <div class="pipeline-step pending" data-phase="7">
                                <div class="step-icon">7</div>
                                <div class="step-label">Security</div>
                            </div>
                            <div class="pipeline-step pending" data-phase="8">
                                <div class="step-icon">8</div>
                                <div class="step-label">Integration</div>
                            </div>
                        </div>
                    </div>

                    <div class="workspace-grid">
                        <!-- File Explorer -->
                        <div class="file-explorer">
                            <div class="explorer-header">
                                <h3>Files</h3>
                                <div class="explorer-actions">
                                    <button class="btn-icon" title="Refresh" id="refresh-files">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                            <path d="M14 8C14 11.31 11.31 14 8 14C4.69 14 2 11.31 2 8C2 4.69 4.69 2 8 2" stroke="currentColor" stroke-width="2"/>
                                            <path d="M8 2L11 5L8 8" stroke="currentColor" stroke-width="2"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="file-tree" id="file-tree-list"></div>

                            <!-- GitHub Integration Widget -->
                            <div class="github-status-widget" id="github-status-widget" style="display: none;">
                                <div class="widget-header">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.041-1.416-4.041-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                    </svg>
                                    <span>Sincronización Git</span>
                                </div>
                                <div class="widget-body">
                                    <div class="status-item">
                                        <span class="label">Estado:</span>
                                        <span class="value" id="git-status-val">Activa</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="label">Próxima Revisión:</span>
                                        <span class="value" id="git-next-review">45 min</span>
                                    </div>
                                    <div class="pr-history">
                                        <span class="label">Historial de PRs:</span>
                                        <ul id="git-pr-list">
                                            <!-- PRs will be loaded here -->
                                            <li class="empty-list">No hay PRs generadas aún</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Preview/Code Area -->
                        <div class="preview-area">
                            <div class="preview-tabs">
                                <button class="tab-btn active" data-tab="preview">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                        <rect x="2" y="3" width="12" height="10" rx="1" stroke="currentColor" stroke-width="1.5"/>
                                        <path d="M2 6H14" stroke="currentColor" stroke-width="1.5"/>
                                    </svg>
                                    Preview
                                </button>
                                <button class="tab-btn" data-tab="code">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                        <path d="M5 4L2 8L5 12M11 4L14 8L11 12" stroke="currentColor" stroke-width="1.5"/>
                                    </svg>
                                    Code
                                </button>
                                <button class="tab-btn" data-tab="issues">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                        <path d="M8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2C11.3137 2 14 4.68629 14 8C14 11.3137 11.3137 14 8 14Z" stroke="currentColor" stroke-width="1.5"/>
                                        <path d="M8 10V8M8 6H8.0075" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Issues
                                </button>
                                <button class="tab-btn" data-tab="security">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                        <path d="M8 2L3 4V7C3 10.55 5.14 13.84 8 15C10.86 13.84 13 10.55 13 7V4L8 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Security
                                </button>
                                <button class="tab-btn" data-tab="compliance">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                        <path d="M7 3H3V13H13V9M13 3L7 9M10 3H13V6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Compliance
                                </button>
                                <button class="tab-btn" data-tab="terminal" id="toggle-terminal-btn">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M2 3L14 3L14 13L2 13L2 3Z"/>
                                        <polyline points="5 6 8 9 5 12"/>
                                    </svg>
                                    Terminal
                                </button>
                                <button class="tab-btn" data-tab="minimap">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                        <circle cx="4" cy="4" r="2" stroke="currentColor" stroke-width="1.5"/>
                                        <circle cx="12" cy="4" r="2" stroke="currentColor" stroke-width="1.5"/>
                                        <circle cx="8" cy="12" r="2" stroke="currentColor" stroke-width="1.5"/>
                                        <path d="M6 4H10M5 6L7 10M11 6L9 10" stroke="currentColor" stroke-width="1"/>
                                    </svg>
                                    Graph
                                </button>
                                <div class="current-file-indicator">
                                    <span id="current-file-name">No file selected</span>
                                </div>
                            </div>

                            <div class="tab-content active" id="preview-tab">
                                <iframe id="preview-frame" sandbox="allow-scripts allow-same-origin"></iframe>
                            </div>

                            <div class="tab-content" id="code-tab">
                                <div id="monaco-editor-container" style="width: 100%; height: 100%; border-radius: var(--border-radius-sm);"></div>
                                <div class="editor-actions">
                                    <button id="run-sandbox-btn" class="btn-primary">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                                        </svg>
                                        Run (Sandbox)
                                    </button>
                                    <button id="save-file-btn" class="btn-primary" style="display: none;">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M13 2H3a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1z"/>
                                            <path d="M7 2v5h6M2 10h12"/>
                                        </svg>
                                        Save Changes
                                    </button>
                                    <button id="refactor-code-btn" class="btn-secondary">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M10 13l-4-4 4-4"/>
                                            <path d="M6 13l4-4-4-4"/>
                                        </svg>
                                        Ask Agent
                                    </button>
                                </div>
                                <div id="sandbox-console" class="sandbox-console" style="display: none;">
                                    <div class="console-header">
                                        <span>Sandbox Output</span>
                                        <button class="close-console">&times;</button>
                                    </div>
                                    <pre id="sandbox-output"></pre>
                                </div>
                            </div>

                            <!-- Issues Tab Content -->
                            <div class="tab-content" id="issues-tab">
                                <div class="issues-list" id="issues-list">
                                    <p class="issues-placeholder">No issues found for this project yet.</p>
                                </div>
                            </div>

                            <!-- Terminal Tab Content (kept for compat, terminal is now floating) -->
                            <div class="tab-content" id="terminal-tab" style="display:none;"></div>

                            <!-- Compliance Tab Content -->
                            <div class="tab-content" id="compliance-tab">
                                <div class="compliance-view">
                                    <div class="view-section">
                                        <h4>Project Dependencies</h4>
                                        <div class="dependency-list" id="project-dependency-list">
                                            <p class="placeholder">Select a project to view dependencies.</p>
                                        </div>
                                    </div>
                                    <div class="view-section">
                                        <h4>License Audit</h4>
                                        <div id="license-audit-summary">
                                            <p class="placeholder">No license audit data available.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Security Tab Content -->
                            <div class="tab-content" id="security-tab">
                                <div class="security-view">
                                    <div class="security-grid">
                                        <!-- Quarantine Area -->
                                        <div class="security-panel quarantine-panel">
                                            <div class="panel-header">
                                                <h4><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0zM12 9v4M12 17h.01"/></svg> Quarantine Zone</h4>
                                                <span class="badge" id="quarantine-count">0</span>
                                            </div>
                                            <div class="quarantine-list" id="quarantine-list">
                                                <p class="placeholder">No files in quarantine.</p>
                                            </div>
                                        </div>

                                        <!-- Security Reports -->
                                        <div class="security-panel reports-panel">
                                            <div class="panel-header">
                                                <h4>Vulnerability Scan</h4>
                                            </div>
                                            <div class="security-reports" id="security-reports-list">
                                                <p class="placeholder">No security reports found.</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Autonomous Interventions Area (Healer activity) -->
                                    <div class="interventions-area" id="autonomous-interventions">
                                        <!-- Cards for CI/CD healing will be injected here -->
                                    </div>
                                </div>
                            </div>

                            <!-- Graph (Mini-map) Tab Content -->
                            <div class="tab-content" id="minimap-tab">
                                <div id="project-minimap-container" style="width: 100%; height: 100%;"></div>
                            </div>
                        </div>

                        <!-- Logs Panel -->
                        <div class="logs-panel">
                            <div class="logs-header">
                                <h3>
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                        <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/>
                                        <path d="M8 5V8L10 10" stroke="currentColor" stroke-width="1.5"/>
                                    </svg>
                                    Live Output
                                </h3>
                                <div class="log-filters">
                                    <button class="log-filter-btn active" data-level="all">All</button>
                                    <button class="log-filter-btn" data-level="info">Info</button>
                                    <button class="log-filter-btn" data-level="warning">Warn</button>
                                    <button class="log-filter-btn" data-level="error">Error</button>
                                    <button class="log-filter-btn" data-level="commands">Cmds</button>
                                </div>
                                <div class="logs-actions">
                                    <button class="btn-icon" id="clear-logs" title="Clear logs">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                            <path d="M4 4L12 12M12 4L4 12" stroke="currentColor" stroke-width="1.5"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="logs-content" id="agent-logs"></div>
                        </div>
                    </div>
                </div>
            </div>