<div id="cicd-view" class="view">
    <div class="view-header">
        <div class="header-info">
            <h1>CI/CD & Mantenimiento Autónomo</h1>
            <p class="text-muted">Auto-sanación de pipelines y ciclos de mejora continua del código.</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-primary" id="run-maintenance-now">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                </svg>
                Ejecutar Mantenimiento
            </button>
        </div>
    </div>

    <div class="grid-container">
        <!-- Dashboard de Estado -->
        <div class="card col-12">
            <div class="card-header">
                <h3>Estado del Sistema de Sanación</h3>
                <div class="status-badge success" id="healer-status-badge">Activo</div>
            </div>
            <div class="card-body status-grid">
                <div class="status-item">
                    <span class="label">Ciclo de Mantenimiento</span>
                    <span class="value" id="maint-interval">Cada 60 min</span>
                </div>
                <div class="status-item">
                    <span class="label">Próxima Ejecución</span>
                    <span class="value" id="maint-next-run">--:--</span>
                </div>
                <div class="status-item">
                    <span class="label">Último Fix CI/CD</span>
                    <span class="value" id="last-ci-fix">Hace 2 horas</span>
                </div>
                <div class="status-item">
                    <span class="label">PRs Creadas</span>
                    <span class="value" id="maint-prs-count">12</span>
                </div>
            </div>
        </div>

        <!-- CI/CD Auto-Healer Analyzer -->
        <div class="card col-7">
            <div class="card-header">
                <h3>Analizador de Fallos CI/CD</h3>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label for="ci-log-input">Log de Error del Pipeline (GitHub Actions/Local)</label>
                    <textarea id="ci-log-input" placeholder="Pega aquí el log de error para analizarlo..." style="min-height: 200px; font-family: var(--font-mono); font-size: 0.8rem;"></textarea>
                </div>
                <div class="form-actions mt-md">
                    <button class="btn btn-secondary" id="analyze-ci-btn">Analizar Fallo</button>
                    <button class="btn btn-primary" id="fix-ci-btn" disabled>Generar Fix Automático</button>
                </div>
                
                <div id="ci-analysis-results" class="mt-lg" style="display: none;">
                    <h4>Resultado del Análisis</h4>
                    <div class="analysis-card mt-sm">
                        <div class="analysis-meta">
                            <span class="badge" id="ci-category">--</span>
                            <span class="confidence">Confianza: <strong id="ci-confidence">0%</strong></span>
                        </div>
                        <p class="root-cause mt-sm"><strong id="ci-root-cause-title">Causa Raíz:</strong> <span id="ci-root-cause-text">--</span></p>
                        <div class="suggested-fixes mt-sm">
                            <strong>Sugerencias:</strong>
                            <ul id="ci-suggestions-list"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Historial de Mantenimiento -->
        <div class="card col-5">
            <div class="card-header">
                <h3>Registro de Mantenimiento</h3>
            </div>
            <div class="card-body">
                <div class="timeline" id="maint-timeline">
                    <!-- Dynamic timeline items -->
                    <div class="empty-state">
                        <p>Cargando historial...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .status-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: var(--spacing-lg);
    }
    .status-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }
    .status-item .label {
        font-size: 0.75rem;
        color: var(--color-text-subtle);
        text-transform: uppercase;
    }
    .status-item .value {
        font-weight: 600;
        color: var(--color-text);
    }
    .analysis-card {
        background: var(--color-surface-elevated);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-md);
        padding: var(--spacing-md);
    }
    .analysis-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .confidence {
        font-size: 0.8rem;
        color: var(--color-text-muted);
    }
    .timeline {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
    }
    .timeline-item {
        padding-left: var(--spacing-md);
        border-left: 2px solid var(--color-border);
        position: relative;
    }
    .timeline-item::before {
        content: '';
        position: absolute;
        left: -5px;
        top: 0;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--color-primary);
    }
    .timeline-item.success::before { background: var(--color-success); }
    .timeline-item.error::before { background: var(--color-error); }
    
    .timeline-content h5 { margin: 0; font-size: 0.9rem; }
    .timeline-content p { margin: 4px 0 0; font-size: 0.8rem; color: var(--color-text-muted); }
    .timeline-content .meta { font-size: 0.7rem; color: var(--color-text-subtle); margin-top: 4px; }
</style>
